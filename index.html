<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCT Virtual Group - Connection & Growth</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 20px;
        }

        .session-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .control-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .control-btn.active {
            background: #4CAF50;
            color: white;
        }

        .phase-container {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s ease-out forwards;
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .phase-title {
            font-size: 1.8rem;
            color: #5a67d8;
            font-weight: bold;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            color: #e53e3e;
            background: rgba(229, 62, 62, 0.1);
            padding: 10px 20px;
            border-radius: 15px;
            min-width: 100px;
            text-align: center;
        }

        .timer-display.warning {
            animation: pulse 1s infinite;
            background: rgba(229, 62, 62, 0.2);
        }

        .five-good-things {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .good-thing {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .good-thing:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .good-thing.selected {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            transform: scale(1.1);
        }

        .good-thing-emoji {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .good-thing-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .good-thing-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .interactive-area {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px dashed #c3c8ff;
        }

        .drawing-canvas {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: crosshair;
            background: white;
            width: 100%;
            max-width: 600px;
            height: 300px;
            margin: 15px auto;
            display: block;
        }

        .canvas-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .canvas-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: #5a67d8;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .canvas-btn:hover {
            background: #4c51bf;
        }

        .poll-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .poll-question {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #5a67d8;
            font-weight: bold;
        }

        .poll-options {
            display: grid;
            gap: 10px;
        }

        .poll-option {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .poll-option:hover {
            border-color: #5a67d8;
            background: #f8f9ff;
        }

        .poll-option.selected {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
        }

        .poll-results {
            margin-top: 15px;
        }

        .poll-result-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .poll-result-label {
            min-width: 200px;
            font-weight: bold;
        }

        .poll-result-progress {
            flex: 1;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .poll-result-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.8s ease;
        }

        .poll-result-percent {
            font-weight: bold;
            color: #5a67d8;
        }

        .chat-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            background: #f8f9ff;
            animation: fadeInUp 0.3s ease;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
        }

        .chat-input:focus {
            border-color: #5a67d8;
        }

        .send-btn {
            padding: 12px 20px;
            background: #5a67d8;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .send-btn:hover {
            background: #4c51bf;
        }

        .activity-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #5a67d8;
        }

        .activity-title {
            font-size: 1.4rem;
            color: #5a67d8;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .phase-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            gap: 20px;
        }

        .nav-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-btn.prev {
            background: #e2e8f0;
            color: #4a5568;
        }

        .nav-btn.next {
            background: #4CAF50;
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .facilitator-notes {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .facilitator-title {
            color: #f57c00;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hidden {
            display: none;
        }

        .reactions-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .reaction-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.9);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .reaction-btn:hover {
            transform: scale(1.1);
            background: white;
        }

        .reaction-btn.active {
            background: #4CAF50;
            transform: scale(1.2);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .inquiry-question-card:hover {
            border-color: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.1);
        }

        .practice-option {
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .practice-option:hover {
            background: #f8f9ff;
            border-color: #5a67d8;
        }

        .practice-option.selected {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
        }

        .scenario-container {
            min-height: 100px;
            padding: 10px;
            border-radius: 8px;
        }

        .scenario-item {
            padding: 15px;
            margin: 10px;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .scenario-item:hover {
            border-color: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .scenario-item.selected {
            background: #5a67d8;
            color: white;
            border-color: #5a67d8;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.3);
        }

        .science-card:hover {
            border-color: #5a67d8;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .grounding-step:hover > div {
            border-color: #5a67d8;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .grounding-step.active > div {
            background: #f8f9ff;
            border-color: #5a67d8;
            transform: scale(1.02);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .phase-header {
                flex-direction: column;
                text-align: center;
            }
            
            .timer-display {
                font-size: 1.5rem;
            }
            
            .five-good-things {
                grid-template-columns: 1fr;
            }
            
            .phase-navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .canvas-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .scenario-item {
                margin: 5px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌟 Recovery Support: Connection & Growth Circle 🌟</h1>
            <p class="subtitle">Virtual RCT-Based Recovery Group</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="session-controls">
            <button class="control-btn" onclick="toggleTimer()">⏯️ Start/Pause</button>
            <button class="control-btn" onclick="resetTimer()">🔄 Reset</button>
            <button class="control-btn" onclick="toggleFacilitatorMode()">👨‍⚕️ Facilitator</button>
            <button class="control-btn" onclick="toggleFullscreen()">🖥️ Fullscreen</button>
        </div>

        <!-- Phase 1: Grounding Through Connection -->
        <div class="phase-container" id="phase1">
            <div class="phase-header">
                <h2 class="phase-title">🌱 Phase 1: Grounding Through Connection</h2>
                <div class="timer-display" id="timer1">10:00</div>
            </div>

            <div class="facilitator-notes">
                <div class="facilitator-title">
                    <span>👨‍⚕️</span> Facilitator Note
                </div>
                <p>Guide teens through relational grounding - we regulate stress through trusted others, not just individual techniques. Model vulnerability while maintaining boundaries.</p>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🌊 Collective Breathing & Arrival (4 min)</h3>
                <p>We'll ground together as a group - connection is more powerful than breathing alone.</p>
                
                <div class="interactive-area" style="text-align: center;">
                    <div id="breathingGuide" style="margin: 20px 0;">
                        <div id="breathingCircle" style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); margin: 0 auto 20px; transition: transform 4s ease-in-out;"></div>
                        <div id="breathingText" style="font-size: 1.5rem; color: #5a67d8; font-weight: bold;">Click to begin breathing together</div>
                        <button class="control-btn" onclick="startGroupBreathing()" id="breathingBtn" style="margin: 15px;">🌊 Start Group Breathing</button>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4 style="color: #5a67d8; margin-bottom: 15px;">Share Your Arrival</h4>
                        <p>How are you arriving to this space today? One word or short phrase:</p>
                        <div class="chat-area" id="arrivalChat" style="max-height: 150px;">
                            <div class="chat-message">
                                <strong>Facilitator:</strong> I'm arriving feeling curious and grateful to be here with all of you. How are you each arriving today? 💙
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="arrivalInput" placeholder="I'm arriving feeling..." maxlength="50">
                            <button class="send-btn" onclick="sendArrivalMessage()">Share</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">👥 5-4-3-2-1 Grounding Through Others (4 min)</h3>
                <p>Let's ground by noticing our shared space and each other's presence:</p>
                
                <div class="interactive-area">
                    <div id="groundingSteps" style="display: grid; gap: 15px;">
                        <div class="grounding-step" data-step="5" onclick="activateGroundingStep(5)">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                <div style="font-size: 2rem;">👀</div>
                                <div>
                                    <strong>5 Things You Can See</strong><br>
                                    <small>Look around your space and share 1 thing you see that makes you feel safe or happy</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grounding-step" data-step="4" onclick="activateGroundingStep(4)">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                <div style="font-size: 2rem;">👂</div>
                                <div>
                                    <strong>4 Things You Can Hear</strong><br>
                                    <small>Notice sounds around you - share 1 sound that brings you peace</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grounding-step" data-step="3" onclick="activateGroundingStep(3)">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                <div style="font-size: 2rem;">✋</div>
                                <div>
                                    <strong>3 Things You Can Touch</strong><br>
                                    <small>Feel textures around you - share 1 texture that feels comforting</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grounding-step" data-step="2" onclick="activateGroundingStep(2)">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                <div style="font-size: 2rem;">👃</div>
                                <div>
                                    <strong>2 Things You Can Smell</strong><br>
                                    <small>Notice scents - share 1 smell that brings good memories</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grounding-step" data-step="1" onclick="activateGroundingStep(1)">
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                <div style="font-size: 2rem;">❤️</div>
                                <div>
                                    <strong>1 Thing You're Grateful For</strong><br>
                                    <small>From your relationships - who or what in your connections brings you gratitude?</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-area" id="groundingChat" style="margin-top: 20px; max-height: 200px;">
                        <div class="chat-message">
                            <strong>Facilitator:</strong> Click on each step above to activate it, then share your responses. Let's ground through our shared experience! 🌱
                        </div>
                    </div>
                    
                    <div class="chat-input-area">
                        <input type="text" class="chat-input" id="groundingInput" placeholder="Share what you notice..." maxlength="100">
                        <button class="send-btn" onclick="sendGroundingMessage()">Share</button>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🎨 Connection Constellation Drawing (2 min)</h3>
                <p>Quickly sketch your support network - who gives you energy today?</p>
                
                <div class="interactive-area">
                    <canvas class="drawing-canvas" id="drawingCanvas1" width="600" height="300"></canvas>
                    <div class="canvas-controls">
                        <button class="canvas-btn" onclick="setDrawingColor('black')">⚫ Black</button>
                        <button class="canvas-btn" onclick="setDrawingColor('blue')">🔵 Blue</button>
                        <button class="canvas-btn" onclick="setDrawingColor('red')">🔴 Red</button>
                        <button class="canvas-btn" onclick="setDrawingColor('green')">🟢 Green</button>
                        <button class="canvas-btn" onclick="setDrawingColor('purple')">🟣 Purple</button>
                        <button class="canvas-btn" onclick="clearCanvas('drawingCanvas1')">🗑️ Clear</button>
                    </div>
                    <p style="text-align: center; margin-top: 10px; color: #666; font-style: italic;">
                        Draw circles, hearts, or shapes for people/pets/communities. Size = how much energy they give you!
                    </p>
                </div>
            </div>
        </div>

        <!-- Phase 2: Check-In with Engaging Questions -->
        <div class="phase-container hidden" id="phase2">
            <div class="phase-header">
                <h2 class="phase-title">💬 Phase 2: Mutual Witnessing</h2>
                <div class="timer-display" id="timer2">15:00</div>
            </div>

            <div class="facilitator-notes">
                <div class="facilitator-title">
                    <span>👨‍⚕️</span> Facilitator Note
                </div>
                <p>Create opportunities for teens to be "therapeutic agents" for each other through peer-to-peer interactions.</p>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🤔 Growth-Fostering Questions</h3>
                
                <div class="poll-container">
                    <div class="poll-question" id="checkInQuestion">What's something you're getting better at, and who notices?</div>
                    <button class="control-btn" onclick="rotateCheckInQuestion()">🔄 Next Question</button>
                </div>

                <div class="chat-area" id="checkInChat">
                    <div class="chat-message">
                        <strong>Facilitator:</strong> Take a moment to think about this question. When you're ready, share what comes up for you. Remember, we're here to witness and support each other. 💙
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="checkInInput" placeholder="Share your thoughts..." maxlength="200">
                    <button class="send-btn" onclick="sendCheckInMessage()">Send</button>
                </div>

                <div class="reactions-container">
                    <button class="reaction-btn" onclick="addSupportReaction('💙')">💙</button>
                    <button class="reaction-btn" onclick="addSupportReaction('🙌')">🙌</button>
                    <button class="reaction-btn" onclick="addSupportReaction('✨')">✨</button>
                    <button class="reaction-btn" onclick="addSupportReaction('🤗')">🤗</button>
                    <button class="reaction-btn" onclick="addSupportReaction('👏')">👏</button>
                </div>
            </div>
        </div>

        <!-- Phase 3: Interactive Learning -->
        <div class="phase-container hidden" id="phase3">
            <div class="phase-header">
                <h2 class="phase-title">🔍 Phase 3: Understanding Growth-Fostering Relationships</h2>
                <div class="timer-display" id="timer3">15:00</div>
            </div>

            <div class="facilitator-notes">
                <div class="facilitator-title">
                    <span>👨‍⚕️</span> Facilitator Note
                </div>
                <p>Position teens as experts of their own relationships while building mutual knowledge about RCT principles.</p>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🧠 The Science of Connection (4 min)</h3>
                <p>Let's explore what research tells us about relationships and healing:</p>
                
                <div class="interactive-area">
                    <div id="scienceExplorer" style="display: grid; gap: 20px;">
                        <div class="science-card" onclick="revealScience(1)" style="cursor: pointer; padding: 20px; border: 2px solid #e2e8f0; border-radius: 15px; transition: all 0.3s ease;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 3rem;">🧠</div>
                                <div>
                                    <h4 style="color: #5a67d8;">Your Brain on Connection</h4>
                                    <p style="margin: 0; color: #666;">Click to discover what happens in your brain during good relationships</p>
                                </div>
                            </div>
                            <div id="scienceContent1" class="hidden" style="margin-top: 15px; padding-top: 15px; border-top: 2px dashed #e2e8f0;">
                                <p><strong>Amazing fact:</strong> When you feel genuinely connected to someone, your brain releases oxytocin (the "connection hormone") and reduces cortisol (stress hormone). This means <em>relationships literally heal your nervous system!</em> 🌟</p>
                            </div>
                        </div>

                        <div class="science-card" onclick="revealScience(2)" style="cursor: pointer; padding: 20px; border: 2px solid #e2e8f0; border-radius: 15px; transition: all 0.3s ease;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 3rem;">💪</div>
                                <div>
                                    <h4 style="color: #5a67d8;">Why Individual Coping Isn't Enough</h4>
                                    <p style="margin: 0; color: #666;">Click to learn why "just breathe" doesn't always work</p>
                                </div>
                            </div>
                            <div id="scienceContent2" class="hidden" style="margin-top: 15px; padding-top: 15px; border-top: 2px dashed #e2e8f0;">
                                <p><strong>Research shows:</strong> Humans are wired to co-regulate (manage stress together) rather than self-regulate alone. When you're stressed, your body actually <em>expects</em> to turn to trusted others. That's why recovery happens best in relationship! 💙</p>
                            </div>
                        </div>

                        <div class="science-card" onclick="revealScience(3)" style="cursor: pointer; padding: 20px; border: 2px solid #e2e8f0; border-radius: 15px; transition: all 0.3s ease;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 3rem;">🌱</div>
                                <div>
                                    <h4 style="color: #5a67d8;">Growth Through Mutuality</h4>
                                    <p style="margin: 0; color: #666;">Click to understand why helping others helps you heal</p>
                                </div>
                            </div>
                            <div id="scienceContent3" class="hidden" style="margin-top: 15px; padding-top: 15px; border-top: 2px dashed #e2e8f0;">
                                <p><strong>Cool discovery:</strong> When you support another person, your brain activates the same "reward circuits" as when you receive support. This means being helpful to others isn't just nice - it's actually healing for you too! 🚀</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">⭐ The Five Good Things Deep Dive (5 min)</h3>
                <p>Let's understand what makes relationships truly growth-fostering:</p>
                
                <div class="interactive-area">
                    <div id="fiveGoodThingsExplorer">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <button class="control-btn" onclick="startFiveGoodThingsJourney()" id="journeyBtn">🌟 Start the Journey</button>
                        </div>
                        
                        <div id="goodThingJourney" class="hidden">
                            <div id="journeyContent" style="text-align: center; font-size: 1.2rem; line-height: 1.6; padding: 30px; background: linear-gradient(135deg, #f8f9ff, #e8f5ff); border-radius: 20px; margin: 20px 0;">
                                <!-- Content will be dynamically loaded -->
                            </div>
                            
                            <div style="text-align: center; margin-top: 20px;">
                                <button class="control-btn" onclick="nextGoodThing()" id="nextGoodThingBtn">Next →</button>
                            </div>
                        </div>

                        <div id="interactiveGoodThings" class="hidden" style="margin-top: 30px;">
                            <h4 style="text-align: center; color: #5a67d8; margin-bottom: 20px;">Now You Try! Click on each one to see examples:</h4>
                            <div class="five-good-things">
                                <div class="good-thing" onclick="exploreGoodThing(this, 'zest')" data-thing="zest">
                                    <span class="good-thing-emoji">🔥</span>
                                    <div class="good-thing-name">Zest</div>
                                    <div class="good-thing-desc">Energy/feeling alive</div>
                                </div>
                                <div class="good-thing" onclick="exploreGoodThing(this, 'worth')" data-thing="worth">
                                    <span class="good-thing-emoji">⭐</span>
                                    <div class="good-thing-name">Worth</div>
                                    <div class="good-thing-desc">Feeling like you matter</div>
                                </div>
                                <div class="good-thing" onclick="exploreGoodThing(this, 'knowledge')" data-thing="knowledge">
                                    <span class="good-thing-emoji">🤝</span>
                                    <div class="good-thing-name">Knowledge</div>
                                    <div class="good-thing-desc">Understanding yourself/others better</div>
                                </div>
                                <div class="good-thing" onclick="exploreGoodThing(this, 'action')" data-thing="action">
                                    <span class="good-thing-emoji">🚀</span>
                                    <div class="good-thing-name">Action</div>
                                    <div class="good-thing-desc">Wanting to do something/make changes</div>
                                </div>
                                <div class="good-thing" onclick="exploreGoodThing(this, 'connection')" data-thing="connection">
                                    <span class="good-thing-emoji">💕</span>
                                    <div class="good-thing-name">More Connection</div>
                                    <div class="good-thing-desc">Wanting more relationships like this</div>
                                </div>
                            </div>
                            
                            <div id="goodThingExamples" style="margin-top: 20px; padding: 20px; background: white; border-radius: 15px; border: 2px solid #e2e8f0; min-height: 100px;">
                                <p style="text-align: center; color: #666; font-style: italic;">Click on the cards above to see real teen examples of each "good thing"! 👆</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🕵️ "Five Good Things" Relationship Detective Game (3 min)</h3>
                <p>Now that you understand the theory, let's be detectives with your own experiences!</p>
                
                <div class="poll-container">
                    <div class="poll-question">Think of a recent relationship moment that felt really good. Which good things did you experience?</div>
                    <div class="poll-options">
                        <div class="poll-option" onclick="selectPollOption(this, 'zest-often')">
                            🔥 Zest - Energy/feeling alive
                        </div>
                        <div class="poll-option" onclick="selectPollOption(this, 'worth-often')">
                            ⭐ Worth - Feeling like you matter
                        </div>
                        <div class="poll-option" onclick="selectPollOption(this, 'knowledge-often')">
                            🤝 Knowledge - Understanding yourself/others better
                        </div>
                        <div class="poll-option" onclick="selectPollOption(this, 'action-often')">
                            🚀 Action - Wanting to do something/make changes
                        </div>
                        <div class="poll-option" onclick="selectPollOption(this, 'connection-often')">
                            💕 More Connection - Wanting more relationships like this
                        </div>
                    </div>
                    <div class="poll-results" id="pollResults1"></div>
                </div>

                <div class="chat-area" id="detectiveChat" style="margin-top: 20px; max-height: 200px;">
                    <div class="chat-message">
                        <strong>Facilitator:</strong> Share your example! What happened, and which "good things" did you notice? Let's learn from each other's relationship wisdom! 🕵️‍♀️
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="detectiveInput" placeholder="Share your relationship moment..." maxlength="200">
                    <button class="send-btn" onclick="sendDetectiveMessage()">Share</button>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">⚖️ "Relationship Toxicity vs. Growth" Interactive Sorting (3 min)</h3>
                <p>Now let's practice recognizing growth-fostering vs. harmful relationship patterns:</p>
                
                <div class="interactive-area">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="background: #ffebee; padding: 20px; border-radius: 10px; border: 2px dashed #f44336;">
                            <h4 style="color: #d32f2f; text-align: center; margin-bottom: 15px;">Not Growth-Fostering</h4>
                            <div id="toxicContainer" class="scenario-container"></div>
                        </div>
                        <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border: 2px dashed #4caf50;">
                            <h4 style="color: #388e3c; text-align: center; margin-bottom: 15px;">Growth-Fostering</h4>
                            <div id="growthContainer" class="scenario-container"></div>
                        </div>
                    </div>
                    
                    <div id="scenarioBank" style="margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 10px;">
                        <h4 style="text-align: center; margin-bottom: 15px;">Scenarios to Sort (Click to Select):</h4>
                        <div class="scenario-item" onclick="toggleScenarioSelection(this)">
                            Your friend only texts when they need homework help
                        </div>
                        <div class="scenario-item" onclick="toggleScenarioSelection(this)">
                            Your cousin always asks how you're really doing and listens
                        </div>
                        <div class="scenario-item" onclick="toggleScenarioSelection(this)">
                            Someone dismisses your feelings when you share them
                        </div>
                        <div class="scenario-item" onclick="toggleScenarioSelection(this)">
                            A friend celebrates your successes without jealousy
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 15px;">
                        <button class="control-btn" onclick="moveSelectedScenarios('growth')">Move to Growth-Fostering →</button>
                        <button class="control-btn" onclick="moveSelectedScenarios('toxic')">Move to Not Growth-Fostering →</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 4: Popcorn Style Inquiry -->
        <div class="phase-container hidden" id="phase4">
            <div class="phase-header">
                <h2 class="phase-title">🍿 Phase 4: Collaborative Problem-Solving</h2>
                <div class="timer-display" id="timer4">15:00</div>
            </div>

            <div class="facilitator-notes">
                <div class="facilitator-title">
                    <span>👨‍⚕️</span> Facilitator Note
                </div>
                <p>Create opportunities for teens to be "therapeutic agents" for each other through peer-to-peer interactions and guided inquiry.</p>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🤝 Peer Consultation Model (5 min)</h3>
                <p>Share a challenge you're facing, and let the group become your consultants (not advice-givers)!</p>
                
                <div class="chat-area" id="consultationChat">
                    <div class="chat-message">
                        <strong>Facilitator:</strong> Remember, we're consultants helping each other think through challenges. Ask questions like "What would you want others to understand?" or "What's worked before?" 🤔
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="consultationInput" placeholder="Share a challenge or offer support..." maxlength="300">
                    <button class="send-btn" onclick="sendConsultationMessage()">Send</button>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🎭 Choose Your Growth Focus (10 min)</h3>
                <p>What relationship challenge would be most helpful to explore today?</p>
                
                <div class="poll-container">
                    <div class="poll-question">Select the area you'd like to focus on:</div>
                    <div class="poll-options">
                        <div class="poll-option practice-option" onclick="selectPracticeType(this, 'family')" data-practice="family">
                            👨‍👩‍👧‍👦 Family Dynamics
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">Having difficult conversations with family members</div>
                        </div>
                        <div class="poll-option practice-option" onclick="selectPracticeType(this, 'friends')" data-practice="friends">
                            👫 Friendship Navigation
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">Maintaining friendships while in recovery</div>
                        </div>
                        <div class="poll-option practice-option" onclick="selectPracticeType(this, 'conflict')" data-practice="conflict">
                            ⚡ Addressing Disconnections
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">How to repair relationships after conflict</div>
                        </div>
                        <div class="poll-option practice-option" onclick="selectPracticeType(this, 'boundaries')" data-practice="boundaries">
                            🛡️ Setting Boundaries
                            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">Protecting your energy while staying connected</div>
                        </div>
                    </div>
                </div>

                <!-- Inquiry Questions Section -->
                <div id="inquirySection" class="hidden" style="margin-top: 30px;">
                    <div class="activity-card" style="background: linear-gradient(135deg, #f8f9ff, #e8f5ff); border: 2px solid #5a67d8;">
                        <h4 id="inquiryTitle" style="color: #5a67d8; text-align: center; margin-bottom: 20px;">Guided Inquiry Questions</h4>
                        
                        <div id="inquiryQuestions" style="display: grid; gap: 15px;">
                            <!-- Questions will be dynamically loaded -->
                        </div>

                        <div class="chat-area" id="inquiryChat" style="margin-top: 20px; max-height: 300px;">
                            <div class="chat-message">
                                <strong>Facilitator:</strong> Take your time with these questions. Share what feels comfortable and ask the group for their thoughts! 💭
                            </div>
                        </div>

                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="inquiryInput" placeholder="Share your thoughts or ask for group input..." maxlength="300">
                            <button class="send-btn" onclick="sendInquiryMessage()">Share</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 5: Check-Out & Commitment -->
        <div class="phase-container hidden" id="phase5">
            <div class="phase-header">
                <h2 class="phase-title">🌉 Phase 5: Bridges to Connection</h2>
                <div class="timer-display" id="timer5">10:00</div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">💭 Connection-Focused Reflections</h3>
                
                <div class="poll-container">
                    <div class="poll-question" id="reflectionQuestion">What's one way this group helped you feel more connected to yourself?</div>
                    <button class="control-btn" onclick="rotateReflectionQuestion()">🔄 Next Reflection</button>
                </div>

                <div class="chat-area" id="reflectionChat">
                    <div class="chat-message">
                        <strong>Facilitator:</strong> As we close our circle, let's reflect on the connections we've built today and how we'll carry them forward. 🌟
                    </div>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="reflectionInput" placeholder="Share your reflection..." maxlength="200">
                    <button class="send-btn" onclick="sendReflectionMessage()">Send</button>
                </div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🤝 Relational Commitment</h3>
                <p>Instead of individual goals, let's focus on connection goals for the week ahead:</p>
                
                <div class="interactive-area">
                    <textarea id="commitmentText" placeholder="Example: 'I want to have one honest conversation with my mom about recovery' or 'I'm going to reach out to that friend I've been avoiding'" 
                              style="width: 100%; height: 100px; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; resize: vertical; font-family: inherit;"></textarea>
                    <button class="control-btn" onclick="shareCommitment()" style="margin-top: 15px;">Share My Commitment</button>
                </div>

                <div id="commitmentsList" style="margin-top: 20px;"></div>
            </div>

            <div class="activity-card">
                <h3 class="activity-title">🤗 Virtual Group Rituals</h3>
                <div style="text-align: center; padding: 20px;">
                    <button class="control-btn" onclick="groupAppreciation()" style="margin: 10px;">💙 Group Appreciation</button>
                    <button class="control-btn" onclick="virtualGroupHug()" style="margin: 10px;">🤗 Virtual Group Hug</button>
                    <button class="control-btn" onclick="powerPose()" style="margin: 10px;">💪 Power Pose Together</button>
                </div>
                
                <div id="ritualArea" style="margin-top: 20px; padding: 20px; background: #f8f9ff; border-radius: 15px; text-align: center; min-height: 100px;">
                    <p style="color: #5a67d8; font-size: 1.2rem;">Choose a ritual to end our session with connection and strength! 🌟</p>
                </div>
            </div>
        </div>

        <div class="phase-navigation">
            <button class="nav-btn prev" onclick="previousPhase()" id="prevBtn" disabled>← Previous Phase</button>
            <div style="text-align: center;">
                <span id="phaseIndicator">Phase 1 of 5</span>
            </div>
            <button class="nav-btn next" onclick="nextPhase()" id="nextBtn">Next Phase →</button>
        </div>
    </div>

    <script>
        let currentPhase = 1;
        let totalPhases = 5;
        let timers = {
            1: 10 * 60, // 10 minutes
            2: 15 * 60, // 15 minutes
            3: 15 * 60, // 15 minutes
            4: 15 * 60, // 15 minutes
            5: 10 * 60  // 10 minutes
        };
        let currentTimer = null;
        let isTimerRunning = false;
        let facilitatorMode = false;
        let drawingColor = 'black';
        let isDrawing = false;

        // Check-in questions for rotation
        const checkInQuestions = [
            "What's something you're getting better at, and who notices?",
            "When did you feel most like yourself this week?",
            "What's a way you helped someone or someone helped you?",
            "What's something about your culture/identity that you want us to know?",
            "What's a small rebellion against ED thoughts you had?"
        ];
        let currentCheckInQuestion = 0;

        // Reflection questions for Phase 5
        const reflectionQuestions = [
            "What's one way this group helped you feel more connected to yourself?",
            "How will you carry what you learned here into your relationships this week?",
            "What's one way you want to be a growth-fostering presence for someone?",
            "What did you offer the group today? What did you receive?"
        ];
        let currentReflectionQuestion = 0;

        // Relationship scenarios for sorting activity
        const scenarios = [
            { text: "Your friend only texts when they need homework help", type: "toxic" },
            { text: "Your cousin always asks how you're really doing and listens", type: "growth" },
            { text: "Someone dismisses your feelings when you share them", type: "toxic" },
            { text: "A friend celebrates your successes without jealousy", type: "growth" },
            { text: "Your sibling makes fun of your recovery efforts", type: "toxic" },
            { text: "Your therapist validates your experiences", type: "growth" }
        ];

        // Initialize the app
        function initializeApp() {
            updatePhaseDisplay();
            setupCanvas();
            initializeScenarioSorting();
            updateProgress();
        }

        // Timer functions
        function startTimer(phase) {
            if (currentTimer) clearInterval(currentTimer);
            
            currentTimer = setInterval(() => {
                if (timers[phase] > 0) {
                    timers[phase]--;
                    updateTimerDisplay(phase);
                    
                    // Warning when 1 minute left
                    if (timers[phase] === 60) {
                        document.getElementById(`timer${phase}`).classList.add('warning');
                    }
                } else {
                    clearInterval(currentTimer);
                    onTimerComplete(phase);
                }
            }, 1000);
            
            isTimerRunning = true;
        }

        function updateTimerDisplay(phase) {
            const minutes = Math.floor(timers[phase] / 60);
            const seconds = timers[phase] % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById(`timer${phase}`).textContent = display;
        }

        function onTimerComplete(phase) {
            document.getElementById(`timer${phase}`).textContent = "Time's up!";
            document.getElementById(`timer${phase}`).style.background = '#4CAF50';
            document.getElementById(`timer${phase}`).style.color = 'white';
            
            // Optional: Auto-advance to next phase
            // setTimeout(() => nextPhase(), 3000);
        }

        function toggleTimer() {
            if (isTimerRunning) {
                clearInterval(currentTimer);
                isTimerRunning = false;
            } else {
                startTimer(currentPhase);
            }
        }

        function resetTimer() {
            clearInterval(currentTimer);
            isTimerRunning = false;
            
            // Reset timer values
            timers[1] = 10 * 60;
            timers[2] = 15 * 60;
            timers[3] = 15 * 60;
            timers[4] = 15 * 60;
            timers[5] = 10 * 60;
            
            // Update all displays
            for (let i = 1; i <= 5; i++) {
                updateTimerDisplay(i);
                document.getElementById(`timer${i}`).classList.remove('warning');
                document.getElementById(`timer${i}`).style.background = '';
                document.getElementById(`timer${i}`).style.color = '';
            }
        }

        // Phase navigation
        function nextPhase() {
            if (currentPhase < totalPhases) {
                document.getElementById(`phase${currentPhase}`).classList.add('hidden');
                currentPhase++;
                document.getElementById(`phase${currentPhase}`).classList.remove('hidden');
                updatePhaseDisplay();
                updateProgress();
                
                // Auto-start timer for new phase
                if (!isTimerRunning) {
                    startTimer(currentPhase);
                }
            }
        }

        function previousPhase() {
            if (currentPhase > 1) {
                document.getElementById(`phase${currentPhase}`).classList.add('hidden');
                currentPhase--;
                document.getElementById(`phase${currentPhase}`).classList.remove('hidden');
                updatePhaseDisplay();
                updateProgress();
            }
        }

        function updatePhaseDisplay() {
            document.getElementById('phaseIndicator').textContent = `Phase ${currentPhase} of ${totalPhases}`;
            document.getElementById('prevBtn').disabled = currentPhase === 1;
            document.getElementById('nextBtn').disabled = currentPhase === totalPhases;
            
            if (currentPhase === totalPhases) {
                document.getElementById('nextBtn').textContent = '🎉 Complete Session';
            } else {
                document.getElementById('nextBtn').textContent = 'Next Phase →';
            }
        }

        function updateProgress() {
            const progress = (currentPhase / totalPhases) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // Five Good Things interaction
        function selectGoodThing(element, type) {
            // Toggle selection
            element.classList.toggle('selected');
            
            // Add to selections (could be used for data collection)
            console.log(`Selected: ${type}`);
        }

        // Reaction system
        function addReaction(emoji) {
            const reactionsContainer = event.target.parentElement;
            const reactionBtn = event.target;
            
            reactionBtn.classList.toggle('active');
            
            // Visual feedback
            const feedback = document.createElement('div');
            feedback.textContent = emoji;
            feedback.style.position = 'absolute';
            feedback.style.fontSize = '2rem';
            feedback.style.animation = 'fadeInUp 0.5s ease-out';
            feedback.style.zIndex = '1000';
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 500);
        }

        function addSupportReaction(emoji) {
            addReaction(emoji);
            
            // Add to chat as a reaction
            const chatArea = document.getElementById('checkInChat');
            const reactionMessage = document.createElement('div');
            reactionMessage.className = 'chat-message';
            reactionMessage.innerHTML = `<strong>Group Reaction:</strong> ${emoji}`;
            chatArea.appendChild(reactionMessage);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // Chat functionality
        function sendCheckInMessage() {
            const input = document.getElementById('checkInInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('checkInChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Participant:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        function sendConsultationMessage() {
            const input = document.getElementById('consultationInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('consultationChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Participant:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        function sendReflectionMessage() {
            const input = document.getElementById('reflectionInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('reflectionChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Participant:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        // Question rotation
        function rotateCheckInQuestion() {
            currentCheckInQuestion = (currentCheckInQuestion + 1) % checkInQuestions.length;
            document.getElementById('checkInQuestion').textContent = checkInQuestions[currentCheckInQuestion];
        }

        function rotateReflectionQuestion() {
            currentReflectionQuestion = (currentReflectionQuestion + 1) % reflectionQuestions.length;
            document.getElementById('reflectionQuestion').textContent = reflectionQuestions[currentReflectionQuestion];
        }

        // Drawing canvas setup
        function setupCanvas() {
            const canvas = document.getElementById('drawingCanvas1');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Set canvas size properly
            const canvasRect = canvas.getBoundingClientRect();
            canvas.width = 600;
            canvas.height = 300;
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
            
            function getTouchPos(e) {
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                return {
                    x: touch.clientX - rect.left,
                    y: touch.clientY - rect.top
                };
            }

            // Mouse events
            canvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                const pos = getMousePos(e);
                lastX = pos.x;
                lastY = pos.y;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDrawing) return;
                
                const pos = getMousePos(e);
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.strokeStyle = drawingColor;
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                
                lastX = pos.x;
                lastY = pos.y;
            });

            canvas.addEventListener('mouseup', () => {
                isDrawing = false;
            });

            canvas.addEventListener('mouseout', () => {
                isDrawing = false;
            });

            // Touch events for mobile
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isDrawing = true;
                const pos = getTouchPos(e);
                lastX = pos.x;
                lastY = pos.y;
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing) return;
                
                const pos = getTouchPos(e);
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.strokeStyle = drawingColor;
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                
                lastX = pos.x;
                lastY = pos.y;
            });

            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                isDrawing = false;
            });
        }

        function setDrawingColor(color) {
            drawingColor = color;
            
            // Visual feedback on color buttons
            document.querySelectorAll('.canvas-btn').forEach(btn => {
                btn.style.background = '#5a67d8';
                btn.style.transform = 'scale(1)';
            });
            
            // Highlight selected color
            event.target.style.background = '#4c51bf';
            event.target.style.transform = 'scale(1.1)';
        }

        function clearCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // Poll functionality
        function selectPollOption(element, option) {
            // Remove selection from siblings
            const siblings = element.parentElement.children;
            for (let sibling of siblings) {
                sibling.classList.remove('selected');
            }
            
            // Select current option
            element.classList.add('selected');
            
            // Update poll results (simplified)
            updatePollResults(option);
        }

        function updatePollResults(selectedOption) {
            // This would typically connect to a real polling system
            console.log('Poll selection:', selectedOption);
        }

        // Scenario sorting for Phase 3
        function loadScenarios() {
            const scenarioBank = document.getElementById('scenarioBank');
            scenarios.forEach(scenario => {
                const scenarioDiv = document.createElement('div');
                scenarioDiv.className = 'scenario-item';
                scenarioDiv.textContent = scenario.text;
                scenarioDiv.style.cssText = `
                    padding: 15px;
                    margin: 10px;
                    background: white;
                    border-radius: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    border: 2px solid #e2e8f0;
                `;
                scenarioDiv.onclick = () => toggleScenarioSelection(scenarioDiv);
                scenarioBank.appendChild(scenarioDiv);
            });
        }

        function toggleScenarioSelection(element) {
            element.classList.toggle('selected');
            if (element.classList.contains('selected')) {
                element.style.background = '#5a67d8';
                element.style.color = 'white';
                element.style.transform = 'scale(1.05)';
            } else {
                element.style.background = 'white';
                element.style.color = '#333';
                element.style.transform = 'scale(1)';
            }
        }

        // Phase 4 - Inquiry Questions by Practice Type
        const inquiryQuestions = {
            family: {
                title: "👨‍👩‍👧‍👦 Family Dynamics Inquiry",
                questions: [
                    "What would you want your family to understand about your recovery journey that they don't seem to get?",
                    "When do you feel most seen and heard by your family members?",
                    "What would a growth-fostering conversation with your family look like?",
                    "How has your eating disorder affected your family relationships, and what would repair look like?",
                    "What's one thing you wish you could say to your family about how they can support you?",
                    "When you think about family meals or food-related conversations, what would make them feel safer?"
                ]
            },
            friends: {
                title: "👫 Friendship Navigation Inquiry", 
                questions: [
                    "How do you want your friends to respond when you're struggling with ED thoughts?",
                    "What friendships give you energy vs. drain your energy? What's the difference?",
                    "How do you balance being honest about your recovery with not wanting to be defined by it?",
                    "What would you want friends to know about how to include you in social activities involving food?",
                    "When you're having a hard day, what kind of support from friends feels most helpful?",
                    "How do you navigate friendships with people who don't understand eating disorders?"
                ]
            },
            conflict: {
                title: "⚡ Addressing Disconnections Inquiry",
                questions: [
                    "When you've had a conflict with someone important to you, what usually happens next?",
                    "What would it look like to repair a relationship after a fight in a way that makes it stronger?",
                    "How do you know when someone is genuinely sorry vs. just trying to end the conflict?",
                    "What's the difference between healthy conflict and destructive conflict in your relationships?",
                    "When you've hurt someone's feelings, what helps you take responsibility without drowning in shame?",
                    "How do you approach someone when they've hurt you but you want to preserve the relationship?"
                ]
            },
            boundaries: {
                title: "🛡️ Setting Boundaries Inquiry",
                questions: [
                    "What's the difference between setting a boundary and pushing someone away?",
                    "When do you most need to set boundaries around your recovery or mental health?",
                    "How do you say 'no' to someone you care about without feeling guilty?",
                    "What would it look like to protect your energy while still being a good friend/family member?",
                    "When someone crosses a boundary you've set, how do you respond in a way that maintains connection?",
                    "What boundaries do you wish others would respect about your eating disorder recovery?"
                ]
            }
        };

        // Practice type selection for Phase 4
        function selectPracticeType(element, type) {
            // Remove selection from siblings
            const siblings = element.parentElement.children;
            for (let sibling of siblings) {
                sibling.classList.remove('selected');
            }
            
            // Select current option
            element.classList.add('selected');
            
            // Show inquiry section
            document.getElementById('inquirySection').classList.remove('hidden');
            
            // Load questions for selected type
            loadInquiryQuestions(type);
        }

        function loadInquiryQuestions(type) {
            const inquiry = inquiryQuestions[type];
            const titleElement = document.getElementById('inquiryTitle');
            const questionsContainer = document.getElementById('inquiryQuestions');
            
            titleElement.textContent = inquiry.title;
            
            questionsContainer.innerHTML = '';
            inquiry.questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'inquiry-question-card';
                questionDiv.style.cssText = `
                    padding: 20px;
                    background: white;
                    border-radius: 12px;
                    border: 2px solid #e2e8f0;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                `;
                
                questionDiv.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="background: #5a67d8; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0;">
                            ${index + 1}
                        </div>
                        <div style="flex: 1;">
                            <p style="margin: 0; font-size: 1.1rem; line-height: 1.5; color: #333;">${question}</p>
                        </div>
                    </div>
                `;
                
                questionDiv.onclick = () => selectInquiryQuestion(questionDiv, question);
                questionsContainer.appendChild(questionDiv);
            });
        }

        function selectInquiryQuestion(element, question) {
            // Visual feedback
            element.style.background = '#f8f9ff';
            element.style.borderColor = '#5a67d8';
            element.style.transform = 'scale(1.02)';
            
            // Add question to chat
            const chatArea = document.getElementById('inquiryChat');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'chat-message';
            questionDiv.innerHTML = `<strong>Focus Question:</strong> ${question}`;
            questionDiv.style.background = '#f0f7ff';
            questionDiv.style.borderLeft = '4px solid #5a67d8';
            chatArea.appendChild(questionDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            // Focus input
            document.getElementById('inquiryInput').focus();
        }

        function sendInquiryMessage() {
            const input = document.getElementById('inquiryInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('inquiryChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Participant:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        // Enhanced scenario sorting with proper drag and click functionality
        function initializeScenarioSorting() {
            const scenarios = [
                { text: "Your friend only texts when they need homework help", correct: "toxic" },
                { text: "Your cousin always asks how you're really doing and listens", correct: "growth" },
                { text: "Someone dismisses your feelings when you share them", correct: "toxic" },
                { text: "A friend celebrates your successes without jealousy", correct: "growth" },
                { text: "Your sibling makes fun of your recovery efforts", correct: "toxic" },
                { text: "Your therapist validates your experiences and challenges you to grow", correct: "growth" },
                { text: "Someone only wants to hang out when you're doing well", correct: "toxic" },
                { text: "A friend checks in on you regularly without needing anything back", correct: "growth" }
            ];

            const scenarioBank = document.getElementById('scenarioBank');
            
            // Clear existing content except header
            const header = scenarioBank.querySelector('h4');
            scenarioBank.innerHTML = '';
            scenarioBank.appendChild(header);
            
            scenarios.forEach((scenario, index) => {
                const scenarioDiv = document.createElement('div');
                scenarioDiv.className = 'scenario-item';
                scenarioDiv.textContent = scenario.text;
                scenarioDiv.draggable = true;
                scenarioDiv.dataset.correct = scenario.correct;
                scenarioDiv.dataset.index = index;
                
                // Add drag and drop functionality
                scenarioDiv.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.index);
                    e.target.style.opacity = '0.5';
                });
                
                scenarioDiv.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '1';
                });
                
                // Keep click functionality
                scenarioDiv.onclick = () => toggleScenarioSelection(scenarioDiv);
                
                scenarioBank.appendChild(scenarioDiv);
            });

            // Add drop zones
            setupDropZones();
        }

        function setupDropZones() {
            const growthContainer = document.getElementById('growthContainer');
            const toxicContainer = document.getElementById('toxicContainer');
            
            [growthContainer, toxicContainer].forEach(container => {
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    container.style.background = container.id === 'growthContainer' ? '#d4edda' : '#f8d7da';
                });
                
                container.addEventListener('dragleave', (e) => {
                    container.style.background = container.id === 'growthContainer' ? '#e8f5e8' : '#ffebee';
                });
                
                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const scenarioIndex = e.dataTransfer.getData('text/plain');
                    const scenarioElement = document.querySelector(`[data-index="${scenarioIndex}"]`);
                    
                    if (scenarioElement) {
                        const isCorrect = scenarioElement.dataset.correct === (container.id === 'growthContainer' ? 'growth' : 'toxic');
                        
                        // Style based on correctness
                        scenarioElement.style.background = isCorrect ? '#d4edda' : '#f8d7da';
                        scenarioElement.style.color = isCorrect ? '#155724' : '#721c24';
                        scenarioElement.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
                        scenarioElement.onclick = null;
                        scenarioElement.draggable = false;
                        
                        // Add feedback
                        if (!isCorrect) {
                            scenarioElement.innerHTML += ' <small style="font-style: italic;">(Think about this one more!)</small>';
                        }
                        
                        container.appendChild(scenarioElement);
                    }
                    
                    container.style.background = container.id === 'growthContainer' ? '#e8f5e8' : '#ffebee';
                });
            });
        }

        // Enhanced scenario selection with better visual feedback
        function toggleScenarioSelection(element) {
            if (element.onclick === null) return; // Already placed
            
            element.classList.toggle('selected');
            if (element.classList.contains('selected')) {
                element.style.background = '#5a67d8';
                element.style.color = 'white';
                element.style.transform = 'scale(1.05)';
                element.style.boxShadow = '0 4px 15px rgba(90, 103, 216, 0.3)';
            } else {
                element.style.background = 'white';
                element.style.color = '#333';
                element.style.transform = 'scale(1)';
                element.style.boxShadow = 'none';
            }
        }

        function moveSelectedScenarios(category) {
            const selectedScenarios = document.querySelectorAll('.scenario-item.selected');
            const targetContainer = document.getElementById(category === 'growth' ? 'growthContainer' : 'toxicContainer');
            
            selectedScenarios.forEach(scenario => {
                const isCorrect = scenario.dataset.correct === category;
                
                scenario.classList.remove('selected');
                scenario.style.background = isCorrect ? '#d4edda' : '#f8d7da';
                scenario.style.color = isCorrect ? '#155724' : '#721c24';
                scenario.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
                scenario.style.transform = 'scale(1)';
                scenario.style.padding = '12px';
                scenario.style.margin = '8px 0';
                scenario.style.borderRadius = '8px';
                scenario.style.boxShadow = 'none';
                scenario.onclick = null; // Remove click handler
                scenario.draggable = false;
                
                // Add feedback for incorrect placements
                if (!isCorrect) {
                    scenario.innerHTML += ' <small style="font-style: italic;">(Hmm, think about this one more!)</small>';
                }
                
                targetContainer.appendChild(scenario);
            });
        }

        // New enter key handlers for Phase 1 & 3
        document.addEventListener('DOMContentLoaded', () => {
            const arrivalInput = document.getElementById('arrivalInput');
            const groundingInput = document.getElementById('groundingInput');
            const detectiveInput = document.getElementById('detectiveInput');
            const inquiryInput = document.getElementById('inquiryInput');

            if (arrivalInput) {
                arrivalInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendArrivalMessage();
                });
            }

            if (groundingInput) {
                groundingInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendGroundingMessage();
                });
            }

            if (detectiveInput) {
                detectiveInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendDetectiveMessage();
                });
            }

            if (inquiryInput) {
                inquiryInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendInquiryMessage();
                });
            }
        });

        // Commitment sharing for Phase 5
        function shareCommitment() {
            const commitmentText = document.getElementById('commitmentText').value.trim();
            if (commitmentText) {
                const commitmentsList = document.getElementById('commitmentsList');
                const commitmentDiv = document.createElement('div');
                commitmentDiv.className = 'chat-message';
                commitmentDiv.innerHTML = `<strong>Commitment:</strong> ${commitmentText}`;
                commitmentsList.appendChild(commitmentDiv);
                
                document.getElementById('commitmentText').value = '';
            }
        }

        // Virtual rituals for Phase 5
        function groupAppreciation() {
            const ritualArea = document.getElementById('ritualArea');
            ritualArea.innerHTML = `
                <h3 style="color: #5a67d8; margin-bottom: 15px;">💙 Group Appreciation Circle</h3>
                <p>Take a moment to send appreciation to someone in the group. Type their name and what you appreciate about them!</p>
                <div style="margin: 20px 0;">
                    <input type="text" placeholder="I appreciate..." style="width: 70%; padding: 10px; border-radius: 10px; border: 2px solid #e2e8f0; margin-right: 10px;">
                    <button onclick="addAppreciation()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 10px; cursor: pointer;">Share</button>
                </div>
                <div id="appreciationList"></div>
            `;
        }

        function addAppreciation() {
            const input = event.target.parentElement.querySelector('input');
            const appreciation = input.value.trim();
            if (appreciation) {
                const appreciationList = document.getElementById('appreciationList');
                const appreciationDiv = document.createElement('div');
                appreciationDiv.style.cssText = 'background: #f8f9ff; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 4px solid #4CAF50;';
                appreciationDiv.textContent = appreciation;
                appreciationList.appendChild(appreciationDiv);
                input.value = '';
            }
        }

        function virtualGroupHug() {
            const ritualArea = document.getElementById('ritualArea');
            ritualArea.innerHTML = `
                <h3 style="color: #5a67d8; margin-bottom: 15px;">🤗 Virtual Group Hug</h3>
                <p style="font-size: 1.5rem; margin: 20px 0;">Everyone give yourself a hug "from the group"!</p>
                <div style="font-size: 4rem; margin: 20px 0; animation: pulse 2s infinite;">🤗</div>
                <p style="color: #666;">Feel the warmth and support from everyone here. You are valued and cared for!</p>
            `;
        }

        function powerPose() {
            const ritualArea = document.getElementById('ritualArea');
            ritualArea.innerHTML = `
                <h3 style="color: #5a67d8; margin-bottom: 15px;">💪 Power Pose Together</h3>
                <p style="font-size: 1.2rem; margin: 20px 0;">Stand up, put your hands on your hips, lift your chin, and feel your strength!</p>
                <div style="font-size: 4rem; margin: 20px 0; animation: pulse 2s infinite;">💪</div>
                <p style="color: #666;">You have the power to grow, connect, and create positive change in your life and relationships!</p>
                <button onclick="countdownPowerPose()" style="padding: 15px 30px; background: #4CAF50; color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 1.1rem; margin-top: 15px;">Start 30-Second Power Pose</button>
            `;
        }

        function countdownPowerPose() {
            let seconds = 30;
            const button = event.target;
            button.disabled = true;
            
            const countdown = setInterval(() => {
                button.textContent = `Power Posing... ${seconds}s`;
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(countdown);
                    button.textContent = '🎉 Amazing! You did it!';
                    button.style.background = '#FFD700';
                    button.style.color = '#333';
                }
            }, 1000);
        }

        // Utility functions
        function toggleFacilitatorMode() {
            facilitatorMode = !facilitatorMode;
            const facilitatorNotes = document.querySelectorAll('.facilitator-notes');
            
            facilitatorNotes.forEach(note => {
                if (facilitatorMode) {
                    note.style.display = 'block';
                } else {
                    note.style.display = 'none';
                }
            });
            
            event.target.classList.toggle('active');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                event.target.textContent = '🪟 Exit Fullscreen';
            } else {
                document.exitFullscreen();
                event.target.textContent = '🖥️ Fullscreen';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' && currentPhase < totalPhases) {
                nextPhase();
            } else if (e.key === 'ArrowLeft' && currentPhase > 1) {
                previousPhase();
            } else if (e.key === ' ' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                toggleTimer();
            }
        });

        // Phase 1 - Grounding Functions
        let breathingInterval = null;
        let breathingActive = false;

        function startGroupBreathing() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            const btn = document.getElementById('breathingBtn');
            
            if (!breathingActive) {
                breathingActive = true;
                btn.textContent = '⏸️ Pause Breathing';
                
                let breatheIn = true;
                text.textContent = 'Breathe in together... 4 counts';
                
                breathingInterval = setInterval(() => {
                    if (breatheIn) {
                        circle.style.transform = 'scale(1.5)';
                        text.textContent = 'Breathe in together... feel the group connection';
                        setTimeout(() => {
                            if (breathingActive) {
                                text.textContent = 'Hold together... 2 counts';
                            }
                        }, 2000);
                    } else {
                        circle.style.transform = 'scale(1)';
                        text.textContent = 'Breathe out together... release as one';
                        setTimeout(() => {
                            if (breathingActive) {
                                text.textContent = 'Pause together... 2 counts';
                            }
                        }, 2000);
                    }
                    breatheIn = !breatheIn;
                }, 4000);
            } else {
                stopGroupBreathing();
            }
        }

        function stopGroupBreathing() {
            breathingActive = false;
            clearInterval(breathingInterval);
            document.getElementById('breathingCircle').style.transform = 'scale(1)';
            document.getElementById('breathingText').textContent = 'Great work breathing together! 🌊';
            document.getElementById('breathingBtn').textContent = '🌊 Start Again';
        }

        function sendArrivalMessage() {
            const input = document.getElementById('arrivalInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('arrivalChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Arrival:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        function activateGroundingStep(step) {
            // Visual feedback
            const stepElement = document.querySelector(`[data-step="${step}"]`);
            stepElement.style.background = '#f8f9ff';
            stepElement.style.borderColor = '#5a67d8';
            stepElement.style.transform = 'scale(1.02)';
            
            // Update chat with prompt
            const prompts = {
                5: "👀 Share 1 thing you can see that makes you feel safe or happy",
                4: "👂 Share 1 sound you hear that brings you peace", 
                3: "✋ Share 1 texture you can touch that feels comforting",
                2: "👃 Share 1 smell that brings good memories",
                1: "❤️ Share 1 person or connection you're grateful for"
            };
            
            const chatArea = document.getElementById('groundingChat');
            const promptDiv = document.createElement('div');
            promptDiv.className = 'chat-message';
            promptDiv.innerHTML = `<strong>Grounding Step ${step}:</strong> ${prompts[step]}`;
            chatArea.appendChild(promptDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function sendGroundingMessage() {
            const input = document.getElementById('groundingInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('groundingChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Grounding Share:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        // Phase 3 - Interactive Learning Functions
        function revealScience(cardNumber) {
            const content = document.getElementById(`scienceContent${cardNumber}`);
            const card = content.parentElement;
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                card.style.background = '#f8f9ff';
                card.style.borderColor = '#5a67d8';
                card.style.transform = 'scale(1.02)';
            } else {
                content.classList.add('hidden');
                card.style.background = '';
                card.style.borderColor = '#e2e8f0';
                card.style.transform = 'scale(1)';
            }
        }

        let currentGoodThingStep = 0;
        const goodThingJourney = [
            {
                emoji: "🌟",
                title: "Welcome to the Five Good Things!",
                content: "These aren't just nice feelings - they're the actual neurobiological markers of relationships that help you heal and grow!"
            },
            {
                emoji: "🔥", 
                title: "ZEST - Energy & Vitality",
                content: "When someone really 'gets' you, you literally feel more alive! Your energy increases because connection activates your parasympathetic nervous system."
            },
            {
                emoji: "⭐",
                title: "WORTH - Feeling Valued",
                content: "This isn't about ego - it's about feeling like you matter to someone. Research shows this literally changes your brain chemistry and reduces depression."
            },
            {
                emoji: "🤝",
                title: "KNOWLEDGE - Mutual Understanding", 
                content: "You learn about yourself AND the other person. Real connection is a two-way street where both people discover new things."
            },
            {
                emoji: "🚀",
                title: "ACTION - Motivation to Grow",
                content: "Good relationships don't make you lazy - they inspire you! When you feel supported, you naturally want to take on challenges and grow."
            },
            {
                emoji: "💕",
                title: "MORE CONNECTION - Wanting Relationships",
                content: "Instead of making you clingy, healthy relationships make you want MORE healthy relationships. They teach you what's possible!"
            }
        ];

        function startFiveGoodThingsJourney() {
            document.getElementById('goodThingJourney').classList.remove('hidden');
            document.getElementById('journeyBtn').style.display = 'none';
            currentGoodThingStep = 0;
            showGoodThingStep();
        }

        function showGoodThingStep() {
            const step = goodThingJourney[currentGoodThingStep];
            const content = document.getElementById('journeyContent');
            
            content.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 20px;">${step.emoji}</div>
                <h3 style="color: #5a67d8; margin-bottom: 15px;">${step.title}</h3>
                <p>${step.content}</p>
            `;
            
            if (currentGoodThingStep === goodThingJourney.length - 1) {
                document.getElementById('nextGoodThingBtn').textContent = '🎯 Now Let\'s Explore!';
            }
        }

        function nextGoodThing() {
            if (currentGoodThingStep < goodThingJourney.length - 1) {
                currentGoodThingStep++;
                showGoodThingStep();
            } else {
                // Show the interactive section
                document.getElementById('goodThingJourney').classList.add('hidden');
                document.getElementById('interactiveGoodThings').classList.remove('hidden');
            }
        }

        const goodThingExamples = {
            zest: [
                "After talking to my best friend about my day, I felt energized enough to clean my room",
                "My therapist really listened to me and I left feeling like I could tackle anything",
                "When my mom asked how I was really doing (not just 'fine'), I felt more alive"
            ],
            worth: [
                "My little brother said I give the best hugs and it made me feel so important",
                "My friend texted me just to check in, not because they needed anything",
                "My coach told me they could see how hard I was trying in recovery"
            ],
            knowledge: [
                "Talking to my friend helped me realize I'm not as weird as I thought",
                "My therapist helped me understand why family dinners feel so hard",
                "Supporting my friend through their anxiety taught me about my own strength"
            ],
            action: [
                "After group therapy, I felt motivated to try eating lunch with friends",
                "My mentor's encouragement made me want to apply for that job",
                "Feeling supported by my family gave me courage to set a boundary"
            ],
            connection: [
                "This friendship is so good, it makes me want to be a better friend to others",
                "Feeling heard in therapy makes me want to join a support group",
                "My relationship with my pet makes me more open to trusting people"
            ]
        };

        function exploreGoodThing(element, type) {
            // Remove selection from other elements
            document.querySelectorAll('.good-thing').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            const examples = goodThingExamples[type];
            const examplesDiv = document.getElementById('goodThingExamples');
            
            let exampleHTML = `<h4 style="color: #5a67d8; margin-bottom: 15px;">Real Teen Examples of ${type.toUpperCase()}:</h4>`;
            examples.forEach(example => {
                exampleHTML += `<div style="background: #f8f9ff; margin: 10px 0; padding: 15px; border-radius: 10px; border-left: 4px solid #5a67d8;">"${example}"</div>`;
            });
            
            examplesDiv.innerHTML = exampleHTML;
        }

        function sendDetectiveMessage() {
            const input = document.getElementById('detectiveInput');
            const message = input.value.trim();
            
            if (message) {
                const chatArea = document.getElementById('detectiveChat');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>Detective Share:</strong> ${message}`;
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                input.value = '';
            }
        }

        function moveSelectedScenarios(category) {
            const selectedScenarios = document.querySelectorAll('.scenario-item.selected');
            const targetContainer = document.getElementById(category === 'growth' ? 'growthContainer' : 'toxicContainer');
            
            selectedScenarios.forEach(scenario => {
                scenario.classList.remove('selected');
                scenario.style.background = category === 'growth' ? '#e8f5e8' : '#ffebee';
                scenario.style.color = category === 'growth' ? '#388e3c' : '#d32f2f';
                scenario.style.transform = 'scale(1)';
                scenario.style.padding = '10px';
                scenario.style.margin = '5px 0';
                scenario.style.borderRadius = '8px';
                scenario.onclick = null; // Remove click handler
                
                targetContainer.appendChild(scenario);
            });
        }

        // Enhanced scenario selection
        function toggleScenarioSelection(element) {
            element.classList.toggle('selected');
            if (element.classList.contains('selected')) {
                element.style.background = '#5a67d8';
                element.style.color = 'white';
                element.style.transform = 'scale(1.05)';
                element.style.boxShadow = '0 4px 15px rgba(90, 103, 216, 0.3)';
            } else {
                element.style.background = 'white';
                element.style.color = '#333';
                element.style.transform = 'scale(1)';
                element.style.boxShadow = 'none';
            }
        }

        // Enter key handlers for inputs
        document.getElementById('checkInInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendCheckInMessage();
        });

        document.getElementById('consultationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendConsultationMessage();
        });

        document.getElementById('reflectionInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendReflectionMessage();
        });

        // New enter key handlers for Phase 1 & 3
        document.addEventListener('DOMContentLoaded', () => {
            const arrivalInput = document.getElementById('arrivalInput');
            const groundingInput = document.getElementById('groundingInput');
            const detectiveInput = document.getElementById('detectiveInput');

            if (arrivalInput) {
                arrivalInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendArrivalMessage();
                });
            }

            if (groundingInput) {
                groundingInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendGroundingMessage();
                });
            }

            if (detectiveInput) {
                detectiveInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendDetectiveMessage();
                });
            }
        });

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Auto-start timer for first phase
        setTimeout(() => {
            startTimer(1);
        }, 2000);
    </script>
</body>
</html>